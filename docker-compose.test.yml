version: '2'

services:
  test:
    image: node:8-alpine@sha256:c9f2470464363addb0be6a61678f44854e73eee974bbc792a71d4d2b7ffd5edd
    depends_on:
      - db
    volumes:  
      - ./:/build
    working_dir: /build
    entrypoint:
      - /bin/sh
      - "-c"
      - "npm install && npm run test:coverage"      
    environment:
      PG_CONNECTION_STRING: postgres://postgres:postgres@db/postgres 
  
  db:
    image: postgres:9.6@sha256:e7684004cf3f064a56b7a2bb35d858ae3226ff12ecf9385828ea4128bb065a98
    environment:
      POSTGRES_USER: postgres
      POSTGRES_PASSWORD: postgres
      POSTGRES_DB: postgres